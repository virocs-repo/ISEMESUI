<div class="k-d-flex k-align-items-center k-gap-3 k-py-2 k-px-4 page-header page-header-desktop">
  <kendo-label text="Search" class="k-font-size-sm">
    <input kendoTextBox [(ngModel)]="searchTerm" type="search" placeholder="Search" class="search-input"
      rounded="full" (input)="onSearchMaster()" />
  </kendo-label>
  <kendo-label text="Customer" class="k-font-size-sm">
    <kendo-combobox [data]="customers" [(ngModel)]="customerSelected" [textField]="'CustomerName'"
      [valueField]="'CustomerID'" placeholder="Select" rounded="full"
      [kendoDropDownFilter]="filterSettings"></kendo-combobox>
  </kendo-label>
  <kendo-label text="Traveller Status" class="k-font-size-sm">
    <kendo-multiselect [data]="travellerStatuses" [(ngModel)]="selectedTravellerStatuses"
      [textField]="'itemText'" [valueField]="'masterListItemId'" placeholder="Select" rounded="full">
    </kendo-multiselect>
  </kendo-label>
  <kendo-label text="Lot Status" class="k-font-size-sm">
    <kendo-multiselect
      [data]="lotStatuses || []"
      [(ngModel)]="selectedLotStatuses"
      [tagMapper]="tagDisplayLimit"
      [textField]="'itemText'"
      [valueField]="'masterListItemId'"
      placeholder="Select Lot Status"
      rounded="full">
    </kendo-multiselect>
  </kendo-label>
  <kendo-label text="Request Types" class="k-font-size-sm">
    <kendo-multiselect
      [data]="requestTypes || []"
      [(ngModel)]="selectedRequestTypes"
      [tagMapper]="tagDisplayLimit"
      [textField]="'itemText'"
      [valueField]="'masterListItemId'"
        placeholder="Select Request Type">
      </kendo-multiselect>
  </kendo-label>
  <kendo-label text="Start Date" class="k-font-size-sm">
    <kendo-datepicker [format]="format" [(value)]="fromDate" rounded="full"></kendo-datepicker>
  </kendo-label>
  <kendo-label text="End Date" class="k-font-size-sm">
    <kendo-datepicker [format]="format" [(value)]="toDate" rounded="full"></kendo-datepicker>
  </kendo-label>
  <div class="k-ml-auto k-d-flex k-gap-2">
    <button kendoButton rounded="full" themeColor="success" (click)="search()">Search</button>
  </div>
</div>
<div
      class="k-d-flex k-align-items-center k-gap-2 k-py-2 k-px-2 k-flex-wrap k-justify-content-between page-header page-header-mobile">
      <h2 class="k-m-0">Receiving</h2>
      <button kendoButton rounded="full" themeColor="info" class="add-btn" (click)="openDialog()">Add</button>
      <div class="search-box k-w-full k-ml-auto">
        <kendo-icon name="search" themeColor="secondary" class="search-icon"></kendo-icon>
        <input kendoTextBox type="search" placeholder="Search" class="search-input k-w-full" rounded="full" />
        <button kendoButton rounded="full" themeColor="success" class="search-btn">Search</button>
      </div>
    </div>
  <div class="page-body k-m-4">
    <kendo-grid [kendoGridBinding]="gridDataResult.data" [selectable]="selectableSettings"
      [columnMenu]="columnMenuSettings" [filterable]="true" [sortable]="true" [resizable]="true" [pageSize]="pageSize"
      [skip]="skip" [pageable]="true" (pageChange)="pageChange($event)"
      class="grid-header-sm grid-header-bold" (cellClick)="onCellClick($event)" [rowClass]="rowCallback">
      <kendo-grid-column field="lotId" title="Lot #" [width]="112"></kendo-grid-column>
      <kendo-grid-column field="controlRoomLocation" title="Control Room Location" [width]="200"></kendo-grid-column>
      <kendo-grid-column field="iseLotNumber" title="ISELot #" [width]="175"></kendo-grid-column>
      <kendo-grid-column field="customerName" title="Customer Name" [width]="135"></kendo-grid-column>
      <kendo-grid-column field="requestor" title="Requestor" [width]="170"></kendo-grid-column>
      <kendo-grid-column field="requestType" title="Request Type" [width]="160"></kendo-grid-column>
      <kendo-grid-column field="lotStatus" title="Lot Status" [width]="160"></kendo-grid-column>
      <kendo-grid-column field="travelerStatus" title="Traveler Status" [width]="125"></kendo-grid-column>
      <kendo-grid-column field="binBox" title="Bin Box" [width]="150"></kendo-grid-column>
      <kendo-grid-column field="noOfBinbox" title="No Of Binbox" [width]="180"></kendo-grid-column>
      <kendo-grid-column field="currentLocation" title="Current Location" [width]="180"></kendo-grid-column>
      <kendo-grid-column field="currentLotLocation" title="Current Lot Location" [width]="180"></kendo-grid-column>
      <kendo-grid-column field="previousStep" title="Previous Step" [width]="180"></kendo-grid-column>
      <kendo-grid-column field="requestedOn" title="Requested On" [width]="180"></kendo-grid-column>
      <kendo-grid-column field="trvStepId" title="TRVStepId" [hidden]="true" ></kendo-grid-column>
    </kendo-grid>
  </div>

  <kendo-contextmenu [items]="rowActionMenu" (select)="onSelectRowActionMenu($event)" size="large"
  #gridContextMenu></kendo-contextmenu>

  @if (isDialogOpen) {
    <kendo-dialog (close)="closeDialog()" [minWidth]="250" [width]="'95%'"
      class="dialog-round receipt-dialog">
      <div class="k-d-flex k-align-items-center k-mb-3 k-gap-3">
        <h3 class="k-m-0">Execute Merge</h3>
        <i class="k-ml-auto"></i>
        <button kendoButton type="button" rounded="full" [svgIcon]="ICON.xIcon" size="small"
        (click)="canCloseDialog()"></button>
      </div>
      <div class="dialog-body k-overflow-y-auto">
        <app-execute-split-merge (onClose)="closeDialog()" (onRestart)="onClearForm()"></app-execute-split-merge>
      </div>
    </kendo-dialog>
  }
  @if (isSplitDialogOpen) {
    <kendo-dialog
      title="Preview -> Traveler Details"
      [minWidth]="900"
      [maxWidth]="1000"
      [height]="600"
      >
      <!-- Header Info (3 columns layout) -->
      <table class="info-table">
        <tr>
          <td>
            <span class="label">Lot Number:</span>
            <span class="value">{{currentHeader.lotNumber}}</span>
          </td>
          <td>
            <span class="label">Customer:</span>
            <span class="value">{{currentHeader.customer}}</span>
          </td>
          <td>
            <span class="label">Category:</span>
            <span class="value">{{currentHeader.category}}</span>
          </td>
        </tr>
        <tr>
          <td>
            <span class="label">Device:</span>
            <span class="value">{{currentHeader.device}}</span>
          </td>
          <td>
            <span class="label">Device Family:</span>
            <span class="value">{{currentHeader.deviceFamily}}</span>
          </td>
          <td>
            <span class="label">DQP ID#:</span>
            <span class="value">{{currentHeader.dqpId}}</span>
          </td>
        </tr>
        <tr>
          <td>
            <span class="label">Actual Quantity:</span>
            <span class="value">{{currentHeader.totalQty}}</span>
          </td>
          <td>
            <span class="label">Current Quantity:</span>
            <span class="value">{{currentHeader.currentQty}}</span>
          </td>
          <td>
            <span class="label">Running Quantity:</span>
            <span class="value">{{currentHeader.runningQty}}</span>
          </td>
        </tr>
      </table>
      <h4 class="section-title">Traveler Steps</h4>
      <!-- Kendo Grid -->
      <kendo-grid
        [data]="currentHeader.previewSteps"
        >
        <kendo-grid-column field="sequence" title="Step #" [width]="80"></kendo-grid-column>
        <kendo-grid-column field="stepname" title="Process" [width]="220"></kendo-grid-column>
        <kendo-grid-column field="qtyIn" title="In" [width]="80"></kendo-grid-column>
        <kendo-grid-column field="qtyOut" title="Out" [width]="80"></kendo-grid-column>
        <kendo-grid-column field="goodQty" title="Good" [width]="80"></kendo-grid-column>
        <kendo-grid-column field="qualifiedRejectQty" title="Qualified Rejects" [width]="140"></kendo-grid-column>
        <kendo-grid-column field="rejectQty" title="Reject" [width]="80"></kendo-grid-column>
        <kendo-grid-column field="processedQty" title="Processed Qty" [width]="120"></kendo-grid-column>
        <kendo-grid-column field="remainingQty" title="UnProcessed Qty" [width]="130"></kendo-grid-column>
        <kendo-grid-column field="timeIn" title="Date-In" [width]="160"></kendo-grid-column>
      </kendo-grid>
      <!-- Footer -->
      <kendo-dialog-actions layout="end">
        <button kendoButton (click)="prev()" [disabled]="currentIndex === 0">Previous</button>
        <button kendoButton (click)="next()" [disabled]="currentIndex === previewResponse.previewHeader.length -1">Next</button>
        <button kendoButton themeColor="primary" (click)="finishFS()">Finish Split</button>
        <button kendoButton (click)="closeSplitDialog()">Cancel</button>
      </kendo-dialog-actions>
    </kendo-dialog>
  }